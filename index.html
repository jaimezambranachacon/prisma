<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRISMA 2020 Interactivo - Jaime Zambrana ChacÃ³n, PhD</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>

<!-- GoJS -->
<script src="https://unpkg.com/gojs/release/go.js"></script>

<style>
  body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
  #diagramDiv { width: 100%; height: 700px; border: 2px solid #ddd; border-radius: 10px; background: #fff; }
  .card { border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
  .header-info { font-size: 0.95rem; text-align: center; margin-bottom: 15px; }
  .header-info a { color: #0d6efd; text-decoration: none; font-weight: bold; }
  .info-btn {
    background: transparent;
    border: none;
    color: #0d6efd;
    font-size: 1.2rem;
    margin-left: 6px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="app" class="container my-4">
  <!-- Encabezado -->
  <div class="header-info">
    <p>
      <b>Modificado en base al manual oficial PRISMA 2020</b> <br>
      by Jaime Zambrana ChacÃ³n, PhD Â· 
      <a href="https://orcid.org/my-orcid?orcid=0000-0002-7765-2926" target="_blank">ORCID</a>
    </p>
  </div>

  <h2 class="text-center text-primary mb-4">ðŸ§­ Generador de Diagrama PRISMA 2020 Interactivo</h2>

  <div class="row">
    <!-- PANEL DE ENTRADA DE DATOS -->
    <div class="col-lg-4">
      <div class="card p-3">
        <h5 class="text-primary">ðŸ“Œ Datos iniciales</h5>

        <div class="mb-2">
          <label class="form-label">
            IdentificaciÃ³n (Registros encontrados)
            <button class="info-btn" data-bs-toggle="modal" data-bs-target="#modalIdentificacion">â„¹</button>
          </label>
          <input type="number" class="form-control" v-model.number="identificacion">
        </div>

        <div class="mb-2">
          <label class="form-label">
            Duplicados eliminados
            <button class="info-btn" data-bs-toggle="modal" data-bs-target="#modalDuplicados">â„¹</button>
          </label>
          <input type="number" class="form-control" v-model.number="duplicados">
        </div>

        <div class="mb-2">
          <label class="form-label">
            Excluidos tras cribado
            <button class="info-btn" data-bs-toggle="modal" data-bs-target="#modalCribado">â„¹</button>
          </label>
          <input type="number" class="form-control" v-model.number="excluidosCribado">
        </div>

        <div class="mb-2">
          <label class="form-label">
            Texto completo excluido
            <button class="info-btn" data-bs-toggle="modal" data-bs-target="#modalTexto">â„¹</button>
          </label>
          <input type="number" class="form-control" v-model.number="excluidosTexto">
        </div>

        <hr>
        <!-- Botones -->
        <button class="btn btn-primary w-100 mb-2" @click="generateDiagram">Generar GrÃ¡fica</button>
        <button class="btn btn-success w-100 mb-2" :disabled="!diagramReady" @click="exportPNG">Descargar PNG</button>
        <button class="btn btn-info w-100 text-white" :disabled="!diagramReady" @click="exportSVG">Descargar SVG</button>
      </div>
    </div>

    <!-- DIAGRAMA -->
    <div class="col-lg-8">
      <div id="diagramDiv"></div>
    </div>
  </div>

  <!-- TABLA EXPLICATIVA -->
  <div class="mt-4">
    <h4 class="mb-3">âœ… SimulaciÃ³n paso a paso (PRISMA)</h4>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Fase</th>
          <th>Cantidad</th>
          <th>ExplicaciÃ³n</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>IdentificaciÃ³n</td>
          <td>{{ identificacion }}</td>
          <td>Registros iniciales encontrados en bases de datos.</td>
        </tr>
        <tr>
          <td>Duplicados eliminados</td>
          <td>{{ duplicados }}</td>
          <td>Se eliminan registros repetidos que no aportan informaciÃ³n nueva.</td>
        </tr>
        <tr>
          <td>Registros cribados</td>
          <td>{{ registrosCribados }}</td>
          <td>DespuÃ©s de quitar duplicados: {{ identificacion }} - {{ duplicados }} = {{ registrosCribados }}.</td>
        </tr>
        <tr>
          <td>Excluidos tras cribado</td>
          <td>{{ excluidosCribado }}</td>
          <td>No cumplen criterios bÃ¡sicos en tÃ­tulo o resumen.</td>
        </tr>
        <tr>
          <td>Reportes elegibilidad</td>
          <td>{{ reportesElegibilidad }}</td>
          <td>{{ registrosCribados }} - {{ excluidosCribado }} = {{ reportesElegibilidad }} analizados en detalle.</td>
        </tr>
        <tr>
          <td>Texto completo excluido</td>
          <td>{{ excluidosTexto }}</td>
          <td>Excluidos tras leer texto completo por no cumplir criterios estrictos.</td>
        </tr>
        <tr>
          <td>Estudios incluidos</td>
          <td>{{ estudiosIncluidos }}</td>
          <td>{{ reportesElegibilidad }} - {{ excluidosTexto }} = {{ estudiosIncluidos }} que cumplen todos los criterios.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- MODALES EXPLICATIVOS -->
<div class="modal fade" id="modalIdentificacion" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Â¿QuÃ© es IdentificaciÃ³n?</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <p><b>Â¿QuÃ© debo poner?</b> NÃºmero total de registros encontrados en todas las fuentes.</p>
        <p><b>Â¿Por quÃ©?</b> Representa el universo inicial antes de filtrar duplicados.</p>
        <p><b>Ejemplo:</b> PubMed (300) + Scopus (150) = 450.</p>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalDuplicados" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Â¿QuÃ© son Duplicados?</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <p><b>Â¿QuÃ© debo poner?</b> Cantidad de registros eliminados por ser repetidos.</p>
        <p><b>Â¿Por quÃ©?</b> Evita contar la misma evidencia dos veces.</p>
        <p><b>Ejemplo:</b> 30 duplicados eliminados.</p>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCribado" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Â¿QuÃ© es Cribado?</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <p><b>Â¿QuÃ© debo poner?</b> NÃºmero de estudios excluidos tras revisiÃ³n rÃ¡pida.</p>
        <p><b>Â¿Por quÃ©?</b> Se eliminan artÃ­culos irrelevantes.</p>
        <p><b>Ejemplo:</b> 9 artÃ­culos eliminados en esta fase.</p>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalTexto" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Â¿QuÃ© es ExclusiÃ³n por Texto Completo?</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <p><b>Â¿QuÃ© debo poner?</b> NÃºmero de artÃ­culos excluidos tras leer texto completo.</p>
        <p><b>Â¿Por quÃ©?</b> No cumplen criterios metodolÃ³gicos mÃ¡s estrictos.</p>
        <p><b>Ejemplo:</b> 2 artÃ­culos excluidos.</p>
      </div>
    </div>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      diagram: null,
      diagramReady: false,
      identificacion: 100,
      duplicados: 30,
      excluidosCribado: 9,
      excluidosTexto: 2
    };
  },
  computed: {
    registrosCribados() { return Math.max(this.identificacion - this.duplicados, 0); },
    reportesElegibilidad() { return Math.max(this.registrosCribados - this.excluidosCribado, 0); },
    estudiosIncluidos() { return Math.max(this.reportesElegibilidad - this.excluidosTexto, 0); }
  },
  methods: {
    initDiagram() {
      const $ = go.GraphObject.make;
      this.diagram = $(go.Diagram, "diagramDiv", {
        layout: $(go.TreeLayout, { angle: 90, layerSpacing: 60 })
      });

      this.diagram.nodeTemplate =
        $(go.Node, "Auto",
          $(go.Shape, "RoundedRectangle", { strokeWidth: 2, width: 330, height: 90 }, new go.Binding("fill", "color")),
          $(go.Panel, "Vertical",
            $(go.TextBlock, { font: "bold 14px Segoe UI", margin: 3, textAlign: "center" }, new go.Binding("text", "title")),
            $(go.TextBlock, { font: "12px Segoe UI", stroke: "#333" }, new go.Binding("text", "value")),
            $(go.TextBlock, { font: "10px Segoe UI", stroke: "#555", wrap: go.TextBlock.WrapFit, textAlign: "center", maxLines: 2 },
              new go.Binding("text", "desc"))
          )
        );

      this.diagram.linkTemplate =
        $(go.Link, { routing: go.Link.Orthogonal, corner: 10 },
          $(go.Shape),
          $(go.Shape, { toArrow: "Standard" })
        );
    },
    generateDiagram() {
      if (!this.diagram) this.initDiagram();
      const nodeDataArray = [
        { key: 1, title: "IdentificaciÃ³n", value: `${this.identificacion}`, desc: "Registros encontrados", color: "#d0e6ff" },
        { key: 2, title: "Duplicados eliminados", value: `${this.duplicados}`, desc: "Repetidos eliminados", color: "#ffe6cc" },
        { key: 3, title: "Cribado", value: `${this.registrosCribados}`, desc: "Filtrado inicial", color: "#ffe6cc" },
        { key: 4, title: "Excluidos cribado", value: `${this.excluidosCribado}`, desc: "No cumplen criterios", color: "#ffe6cc" },
        { key: 5, title: "Elegibilidad", value: `${this.reportesElegibilidad}`, desc: "AnÃ¡lisis profundo", color: "#d6f5d6" },
        { key: 6, title: "Excluidos texto", value: `${this.excluidosTexto}`, desc: "Descartados tras lectura", color: "#d6f5d6" },
        { key: 7, title: "InclusiÃ³n", value: `${this.estudiosIncluidos}`, desc: "Estudios finales", color: "#e6d6f5" }
      ];
      const linkDataArray = [
        { from: 1, to: 2 }, { from: 2, to: 3 }, { from: 3, to: 4 },
        { from: 3, to: 5 }, { from: 5, to: 6 }, { from: 5, to: 7 }
      ];
      this.diagram.model = new go.GraphLinksModel(nodeDataArray, linkDataArray);
      this.diagramReady = true;
    },
    exportPNG() {
      const img = this.diagram.makeImageData({ scale: 1.5, background: "white" });
      const link = document.createElement('a');
      link.href = img;
      link.download = 'PRISMA-diagrama.png';
      link.click();
    },
    exportSVG() {
      const svg = this.diagram.makeSvg({ scale: 1.5, background: "white" });
      const serializer = new XMLSerializer();
      const svgStr = serializer.serializeToString(svg);
      const blob = new Blob([svgStr], { type: "image/svg+xml" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'PRISMA-diagrama.svg';
      link.click();
    }
  },
  mounted() {
    this.initDiagram();
  }
}).mount('#app');
</script>
</body>
</html>
